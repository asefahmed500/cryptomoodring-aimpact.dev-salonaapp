"use strict";(()=>{var e={};e.id=663,e.ids=[663],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},83648:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>v,routeModule:()=>g,serverHooks:()=>q,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>h});var i={};t.r(i),t.d(i,{POST:()=>m});var n=t(89462),s=t(75345),o=t(57143),a=t(92969),u=t(90619),c=t(76388),d=t(33828),p=t(11185),l=t.n(p);async function m(e){try{await (0,c.Z)();let r=await (0,u.getServerSession)();if(!r?.user?.email)return a.Z.json({message:"Unauthorized"},{status:401});let{predictionId:t,actualPrice:i,isCorrect:n}=await e.json();if(!t||void 0===i||void 0===n)return a.Z.json({message:"Missing required fields: predictionId, actualPrice, isCorrect"},{status:400});if(!l().Types.ObjectId.isValid(t))return a.Z.json({message:"Invalid prediction ID"},{status:400});if("number"!=typeof i||i<=0)return a.Z.json({message:"Actual price must be a positive number"},{status:400});if("boolean"!=typeof n)return a.Z.json({message:"isCorrect must be a boolean"},{status:400});let s=await d.Z.findOneAndUpdate({_id:t,userId:r.user.email,status:"pending"},{actualPrice:parseFloat(i.toString()),status:n?"correct":"incorrect",resolvedAt:new Date},{new:!0});if(!s)return a.Z.json({message:"Prediction not found or already resolved"},{status:404});return a.Z.json(s)}catch(e){return console.error("Resolve prediction error:",e),a.Z.json({message:"Internal server error"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/predictions/resolve/route",pathname:"/api/predictions/resolve",filename:"route",bundlePath:"app/api/predictions/resolve/route"},resolvedPagePath:"E:\\project_qcatuy\\src\\app\\api\\predictions\\resolve\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:q,headerHooks:f,staticGenerationBailout:h}=g,y="/api/predictions/resolve/route";function b(){return(0,o.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:x})}},76388:(e,r,t)=>{t.d(r,{Z:()=>a});var i=t(11185),n=t.n(i);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let a=async function(){if(o.conn)return o.conn;o.promise||(o.promise=n().connect(s,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},33828:(e,r,t)=>{t.d(r,{Z:()=>o});var i=t(11185),n=t.n(i);let s=new(n()).Schema({userId:{type:String,required:!0,index:!0},symbol:{type:String,required:!0,uppercase:!0,trim:!0},direction:{type:String,required:!0,enum:["up","down"]},confidence:{type:Number,required:!0,min:1,max:10},targetPrice:{type:Number,required:!1,min:0},timeframe:{type:String,required:!0,enum:["1h","4h","1d","1w","1m"]},reasoning:{type:String,required:!0,maxlength:1e3,trim:!0},status:{type:String,default:"pending",enum:["pending","correct","incorrect"]},actualPrice:{type:Number,required:!1,min:0},resolvedAt:{type:Date,required:!1}},{timestamps:!0});s.index({userId:1,createdAt:-1}),s.index({userId:1,status:1}),s.index({userId:1,symbol:1}),s.virtual("isResolved").get(function(){return"pending"!==this.status}),s.methods.calculateCorrectness=function(e){return this.targetPrice?"up"===this.direction?e>=this.targetPrice:e<=this.targetPrice:null};let o=n().models.Prediction||n().model("Prediction",s)}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[120,971,363,619],()=>t(83648));module.exports=i})();