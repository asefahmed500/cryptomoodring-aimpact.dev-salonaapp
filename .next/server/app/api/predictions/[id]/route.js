"use strict";(()=>{var e={};e.id=168,e.ids=[168],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},41102:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>q,originalPathname:()=>Z,patchFetch:()=>P,requestAsyncStorage:()=>h,routeModule:()=>y,serverHooks:()=>x,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>j});var i={};r.r(i),r.d(i,{DELETE:()=>f,GET:()=>m,PUT:()=>g});var n=r(89462),s=r(75345),o=r(57143),a=r(92969),u=r(90619),d=r(76388),c=r(33828),l=r(11185),p=r.n(l);async function m(e,{params:t}){try{await (0,d.Z)();let e=await (0,u.getServerSession)();if(!e?.user?.email)return a.Z.json({message:"Unauthorized"},{status:401});if(!p().Types.ObjectId.isValid(t.id))return a.Z.json({message:"Invalid prediction ID"},{status:400});let r=await c.Z.findOne({_id:t.id,userId:e.user.email}).lean();if(!r)return a.Z.json({message:"Prediction not found"},{status:404});return a.Z.json(r)}catch(e){return console.error("Get prediction error:",e),a.Z.json({message:"Internal server error"},{status:500})}}async function g(e,{params:t}){try{await (0,d.Z)();let r=await (0,u.getServerSession)();if(!r?.user?.email)return a.Z.json({message:"Unauthorized"},{status:401});if(!p().Types.ObjectId.isValid(t.id))return a.Z.json({message:"Invalid prediction ID"},{status:400});let i=await e.json(),n={};i.status&&["pending","correct","incorrect"].includes(i.status)&&(n.status=i.status),void 0!==i.actualPrice&&"number"==typeof i.actualPrice&&i.actualPrice>0&&(n.actualPrice=i.actualPrice),i.resolvedAt&&(n.resolvedAt=new Date(i.resolvedAt));let s=await c.Z.findOne({_id:t.id,userId:r.user.email});if(!s)return a.Z.json({message:"Prediction not found"},{status:404});if("pending"!==s.status&&"pending"!==n.status)return a.Z.json({message:"Cannot modify resolved prediction"},{status:400});let o=await c.Z.findOneAndUpdate({_id:t.id,userId:r.user.email},n,{new:!0});return a.Z.json(o)}catch(e){return console.error("Update prediction error:",e),a.Z.json({message:"Internal server error"},{status:500})}}async function f(e,{params:t}){try{await (0,d.Z)();let e=await (0,u.getServerSession)();if(!e?.user?.email)return a.Z.json({message:"Unauthorized"},{status:401});if(!p().Types.ObjectId.isValid(t.id))return a.Z.json({message:"Invalid prediction ID"},{status:400});if(!await c.Z.findOneAndDelete({_id:t.id,userId:e.user.email}))return a.Z.json({message:"Prediction not found"},{status:404});return a.Z.json({message:"Prediction deleted successfully"})}catch(e){return console.error("Delete prediction error:",e),a.Z.json({message:"Internal server error"},{status:500})}}let y=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/predictions/[id]/route",pathname:"/api/predictions/[id]",filename:"route",bundlePath:"app/api/predictions/[id]/route"},resolvedPagePath:"E:\\project_qcatuy\\src\\app\\api\\predictions\\[id]\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:v,serverHooks:x,headerHooks:q,staticGenerationBailout:j}=y,Z="/api/predictions/[id]/route";function P(){return(0,o.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:v})}},76388:(e,t,r)=>{r.d(t,{Z:()=>a});var i=r(11185),n=r.n(i);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let a=async function(){if(o.conn)return o.conn;o.promise||(o.promise=n().connect(s,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},33828:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),n=r.n(i);let s=new(n()).Schema({userId:{type:String,required:!0,index:!0},symbol:{type:String,required:!0,uppercase:!0,trim:!0},direction:{type:String,required:!0,enum:["up","down"]},confidence:{type:Number,required:!0,min:1,max:10},targetPrice:{type:Number,required:!1,min:0},timeframe:{type:String,required:!0,enum:["1h","4h","1d","1w","1m"]},reasoning:{type:String,required:!0,maxlength:1e3,trim:!0},status:{type:String,default:"pending",enum:["pending","correct","incorrect"]},actualPrice:{type:Number,required:!1,min:0},resolvedAt:{type:Date,required:!1}},{timestamps:!0});s.index({userId:1,createdAt:-1}),s.index({userId:1,status:1}),s.index({userId:1,symbol:1}),s.virtual("isResolved").get(function(){return"pending"!==this.status}),s.methods.calculateCorrectness=function(e){return this.targetPrice?"up"===this.direction?e>=this.targetPrice:e<=this.targetPrice:null};let o=n().models.Prediction||n().model("Prediction",s)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[120,284,969,619],()=>r(41102));module.exports=i})();