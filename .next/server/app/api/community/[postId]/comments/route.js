"use strict";(()=>{var e={};e.id=949,e.ids=[949],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},12998:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>q,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>x});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>l});var s=r(89462),o=r(75345),i=r(57143),a=r(92969),u=r(90619),m=r(76388),c=r(42097);async function d(e,{params:t}){try{await (0,m.Z)();let{postId:e}=t;if(!e)return a.Z.json({message:"Post ID is required"},{status:400});let r=await c.Z.findById(e).select("comments").lean();if(!r)return a.Z.json({message:"Post not found"},{status:404});return a.Z.json({comments:r.comments.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())})}catch(e){return console.error("Get comments error:",e),a.Z.json({message:"Internal server error"},{status:500})}}async function l(e,{params:t}){try{await (0,m.Z)();let r=await (0,u.getServerSession)();if(!r?.user?.email)return a.Z.json({message:"Unauthorized"},{status:401});let{postId:n}=t,{content:s}=await e.json();if(!n)return a.Z.json({message:"Post ID is required"},{status:400});if(!s||0===s.trim().length)return a.Z.json({message:"Comment content is required"},{status:400});if(s.length>200)return a.Z.json({message:"Comment must be 200 characters or less"},{status:400});let o=await c.Z.findById(n);if(!o)return a.Z.json({message:"Post not found"},{status:404});let i={id:new Date().getTime().toString(),userId:r.user.email,username:r.user.name||"Anonymous",content:s.trim(),createdAt:new Date};return o.comments.push(i),await o.save(),a.Z.json({comment:i,message:"Comment added successfully"},{status:201})}catch(e){return console.error("Add comment error:",e),a.Z.json({message:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/community/[postId]/comments/route",pathname:"/api/community/[postId]/comments",filename:"route",bundlePath:"app/api/community/[postId]/comments/route"},resolvedPagePath:"E:\\project_qcatuy\\src\\app\\api\\community\\[postId]\\comments\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:y,headerHooks:f,staticGenerationBailout:x}=p,q="/api/community/[postId]/comments/route";function v(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},76388:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),s=r.n(n);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let a=async function(){if(i.conn)return i.conn;i.promise||(i.promise=s().connect(o,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},42097:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),s=r.n(n);let o=new(s()).Schema({userId:{type:String,required:!0,index:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:500,trim:!0},mood:{type:Number,required:!0,min:1,max:10},marketSentiment:{type:String,enum:["bullish","bearish","neutral"],required:!0},cryptoSymbol:{type:String,uppercase:!0,trim:!0},tags:[{type:String,trim:!0,lowercase:!0}],likes:[{type:String}],comments:[{id:{type:String,default:()=>new(s()).Types.ObjectId().toString()},userId:{type:String,required:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:200,trim:!0},createdAt:{type:Date,default:Date.now}}],isPublic:{type:Boolean,default:!0}},{timestamps:!0});o.index({createdAt:-1}),o.index({userId:1,createdAt:-1}),o.index({isPublic:1,createdAt:-1}),o.index({tags:1}),o.index({cryptoSymbol:1}),o.virtual("commentCount").get(function(){return this.comments.length}),o.virtual("likeCount").get(function(){return this.likes.length}),o.methods.isLikedBy=function(e){return this.likes.includes(e)},o.methods.addLike=function(e){return this.likes.includes(e)||this.likes.push(e),this.save()},o.methods.removeLike=function(e){return this.likes=this.likes.filter(t=>t!==e),this.save()},o.methods.addComment=function(e,t,r){return this.comments.push({id:new(s()).Types.ObjectId().toString(),userId:e,username:t,content:r.trim(),createdAt:new Date}),this.save()};let i=s().models.CommunityPost||s().model("CommunityPost",o)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[120,971,363,619],()=>r(12998));module.exports=n})();