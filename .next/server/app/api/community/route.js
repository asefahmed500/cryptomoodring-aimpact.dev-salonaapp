"use strict";(()=>{var e={};e.id=860,e.ids=[860],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},626:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>x,originalPathname:()=>b,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>f});var n={};r.r(n),r.d(n,{GET:()=>c,POST:()=>p});var s=r(89462),i=r(75345),o=r(57143),a=r(92969),u=r(90619),m=r(76388),l=r(42097);async function c(e){try{await (0,m.Z)();let{searchParams:t}=new URL(e.url),r=parseInt(t.get("page")||"1"),n=parseInt(t.get("limit")||"20"),s=t.get("tag"),i=t.get("symbol"),o=t.get("sentiment"),u={isPublic:!0};s&&(u.tags={$in:[s.toLowerCase()]}),i&&(u.cryptoSymbol=i.toUpperCase()),o&&["bullish","bearish","neutral"].includes(o)&&(u.marketSentiment=o);let c=(r-1)*n,p=await l.Z.find(u).sort({createdAt:-1}).skip(c).limit(n).lean(),d=await l.Z.countDocuments(u),g=Math.ceil(d/n);return a.Z.json({posts:p,pagination:{page:r,limit:n,totalPosts:d,totalPages:g,hasNext:r<g,hasPrev:r>1}})}catch(e){return console.error("Get posts error:",e),a.Z.json({message:"Internal server error"},{status:500})}}async function p(e){try{await (0,m.Z)();let t=await (0,u.getServerSession)();if(!t?.user?.email)return a.Z.json({message:"Unauthorized"},{status:401});let{content:r,mood:n,marketSentiment:s,cryptoSymbol:i,tags:o}=await e.json();if(!r||!n||!s)return a.Z.json({message:"Missing required fields: content, mood, marketSentiment"},{status:400});if(0===r.trim().length||r.length>500)return a.Z.json({message:"Content must be between 1 and 500 characters"},{status:400});if(n<1||n>10)return a.Z.json({message:"Mood must be between 1 and 10"},{status:400});if(!["bullish","bearish","neutral"].includes(s))return a.Z.json({message:"Invalid market sentiment"},{status:400});let c=o?o.split(",").map(e=>e.trim().toLowerCase()).filter(e=>e.length>0).slice(0,5):[],p=await l.Z.create({userId:t.user.email,username:t.user.name||"Anonymous",content:r.trim(),mood:parseInt(n),marketSentiment:s,cryptoSymbol:i?i.toUpperCase():void 0,tags:c,likes:[],comments:[],isPublic:!0});return a.Z.json(p,{status:201})}catch(e){return console.error("Create post error:",e),a.Z.json({message:"Internal server error"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/community/route",pathname:"/api/community",filename:"route",bundlePath:"app/api/community/route"},resolvedPagePath:"E:\\project_qcatuy\\src\\app\\api\\community\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:y,headerHooks:x,staticGenerationBailout:f}=d,b="/api/community/route";function q(){return(0,o.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},76388:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),s=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let a=async function(){if(o.conn)return o.conn;o.promise||(o.promise=s().connect(i,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},42097:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(11185),s=r.n(n);let i=new(s()).Schema({userId:{type:String,required:!0,index:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:500,trim:!0},mood:{type:Number,required:!0,min:1,max:10},marketSentiment:{type:String,enum:["bullish","bearish","neutral"],required:!0},cryptoSymbol:{type:String,uppercase:!0,trim:!0},tags:[{type:String,trim:!0,lowercase:!0}],likes:[{type:String}],comments:[{id:{type:String,default:()=>new(s()).Types.ObjectId().toString()},userId:{type:String,required:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:200,trim:!0},createdAt:{type:Date,default:Date.now}}],isPublic:{type:Boolean,default:!0}},{timestamps:!0});i.index({createdAt:-1}),i.index({userId:1,createdAt:-1}),i.index({isPublic:1,createdAt:-1}),i.index({tags:1}),i.index({cryptoSymbol:1}),i.virtual("commentCount").get(function(){return this.comments.length}),i.virtual("likeCount").get(function(){return this.likes.length}),i.methods.isLikedBy=function(e){return this.likes.includes(e)},i.methods.addLike=function(e){return this.likes.includes(e)||this.likes.push(e),this.save()},i.methods.removeLike=function(e){return this.likes=this.likes.filter(t=>t!==e),this.save()},i.methods.addComment=function(e,t,r){return this.comments.push({id:new(s()).Types.ObjectId().toString(),userId:e,username:t,content:r.trim(),createdAt:new Date}),this.save()};let o=s().models.CommunityPost||s().model("CommunityPost",i)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[120,971,363,619],()=>r(626));module.exports=n})();