"use strict";(()=>{var e={};e.id=961,e.ids=[961],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},12517:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>b,originalPathname:()=>P,patchFetch:()=>w,requestAsyncStorage:()=>q,routeModule:()=>h,serverHooks:()=>v,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>S});var n={};r.r(n),r.d(n,{GET:()=>x,dynamic:()=>y});var i=r(89462),o=r(75345),s=r(57143),a=r(92969),u=r(90619),c=r(76388),d=r(11185),l=r.n(d);let p=new d.Schema({userId:{type:d.Schema.Types.ObjectId,ref:"User",required:!0},mood:{type:Number,required:!0,min:1,max:10},emotions:[{type:String,required:!0}],notes:{type:String,maxlength:500},marketCondition:{type:String,enum:["bullish","bearish","neutral"],required:!0},confidence:{type:Number,required:!0,min:1,max:10},timestamp:{type:Date,default:Date.now}}),m=l().models.MoodEntry||l().model("MoodEntry",p);var g=r(33828);let y="force-dynamic";async function x(e){try{await (0,c.Z)();let e=await (0,u.getServerSession)(),t=e?.user?.id;if(!t)return a.Z.json({totalMoods:0,totalPredictions:0,accuracyScore:0,streakDays:0,error:"Unauthorized"},{status:401});let[r,n,i,o]=await Promise.all([m.countDocuments({userId:t}).exec(),g.Z.countDocuments({userId:t}).exec(),g.Z.find({userId:t,isResolved:!0}).lean().exec(),m.find({userId:t}).sort({timestamp:-1}).limit(30).lean().exec()]),s=i.length>0?Math.round(i.reduce((e,t)=>e+(t.accuracy||0),0)/i.length):0,d=0,l=new Date;l.setHours(0,0,0,0);for(let e=0;e<o.length;e++){let t=new Date(o[e].timestamp);t.setHours(0,0,0,0);let r=new Date(l);if(r.setDate(l.getDate()-e),t.getTime()===r.getTime())d++;else break}return a.Z.json({totalMoods:r,totalPredictions:n,accuracyScore:s,streakDays:d})}catch(e){return console.error("Get stats error:",e),a.Z.json({totalMoods:0,totalPredictions:0,accuracyScore:0,streakDays:0,error:"Internal server error"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/stats/route",pathname:"/api/stats",filename:"route",bundlePath:"app/api/stats/route"},resolvedPagePath:"E:\\project_qcatuy\\src\\app\\api\\stats\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:q,staticGenerationAsyncStorage:f,serverHooks:v,headerHooks:b,staticGenerationBailout:S}=h,P="/api/stats/route";function w(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:f})}},76388:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),i=r.n(n);let o=process.env.MONGODB_URI;if(!o)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let a=async function(){if(s.conn)return s.conn;s.promise||(s.promise=i().connect(o,{bufferCommands:!1}).then(e=>e));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}},33828:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(11185),i=r.n(n);let o=new(i()).Schema({userId:{type:String,required:!0,index:!0},symbol:{type:String,required:!0,uppercase:!0,trim:!0},direction:{type:String,required:!0,enum:["up","down"]},confidence:{type:Number,required:!0,min:1,max:10},targetPrice:{type:Number,required:!1,min:0},timeframe:{type:String,required:!0,enum:["1h","4h","1d","1w","1m"]},reasoning:{type:String,required:!0,maxlength:1e3,trim:!0},status:{type:String,default:"pending",enum:["pending","correct","incorrect"]},actualPrice:{type:Number,required:!1,min:0},resolvedAt:{type:Date,required:!1}},{timestamps:!0});o.index({userId:1,createdAt:-1}),o.index({userId:1,status:1}),o.index({userId:1,symbol:1}),o.virtual("isResolved").get(function(){return"pending"!==this.status}),o.methods.calculateCorrectness=function(e){return this.targetPrice?"up"===this.direction?e>=this.targetPrice:e<=this.targetPrice:null};let s=i().models.Prediction||i().model("Prediction",o)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[120,971,363,619],()=>r(12517));module.exports=n})();