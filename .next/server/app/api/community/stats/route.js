"use strict";(()=>{var t={};t.id=884,t.ids=[884],t.modules={11185:t=>{t.exports=require("mongoose")},30517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},22356:(t,e,n)=>{n.r(e),n.d(e,{headerHooks:()=>h,originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>$});var i={};n.r(i),n.d(i,{GET:()=>l});var o=n(89462),r=n(75345),s=n(57143),a=n(92969),u=n(76388),m=n(42097);async function l(t){try{await (0,u.Z)();let t=await m.Z.countDocuments({isPublic:!0}),e=await m.Z.aggregate([{$match:{isPublic:!0}},{$group:{_id:null,totalLikes:{$sum:{$size:"$likes"}},totalComments:{$sum:{$size:"$comments"}},avgMood:{$avg:"$mood"},bullishPosts:{$sum:{$cond:[{$eq:["$marketSentiment","bullish"]},1,0]}},bearishPosts:{$sum:{$cond:[{$eq:["$marketSentiment","bearish"]},1,0]}},neutralPosts:{$sum:{$cond:[{$eq:["$marketSentiment","neutral"]},1,0]}}}}]),n=await m.Z.aggregate([{$match:{isPublic:!0}},{$unwind:"$tags"},{$group:{_id:"$tags",count:{$sum:1}}},{$sort:{count:-1}},{$limit:10},{$project:{tag:"$_id",count:1,_id:0}}]),i=await m.Z.aggregate([{$match:{isPublic:!0,$and:[{cryptoSymbol:{$exists:!0}},{cryptoSymbol:{$ne:null}},{cryptoSymbol:{$ne:""}}]}},{$group:{_id:"$cryptoSymbol",count:{$sum:1},avgMood:{$avg:"$mood"},sentiment:{$push:"$marketSentiment"}}},{$sort:{count:-1}},{$limit:10},{$project:{symbol:"$_id",count:1,avgMood:{$round:["$avgMood",1]},_id:0}}]),o=new Date;o.setDate(o.getDate()-1);let r=await m.Z.countDocuments({isPublic:!0,createdAt:{$gte:o}}),s={totalPosts:t,totalLikes:e[0]?.totalLikes||0,totalComments:e[0]?.totalComments||0,avgMood:e[0]?.avgMood?Number(e[0].avgMood.toFixed(1)):0,sentiment:{bullish:e[0]?.bullishPosts||0,bearish:e[0]?.bearishPosts||0,neutral:e[0]?.neutralPosts||0},trendingTags:n,trendingSymbols:i,recentActivity:r};return a.Z.json(s)}catch(t){return console.error("Get community stats error:",t),a.Z.json({message:"Internal server error"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/community/stats/route",pathname:"/api/community/stats",filename:"route",bundlePath:"app/api/community/stats/route"},resolvedPagePath:"E:\\project_qcatuy\\src\\app\\api\\community\\stats\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:g,headerHooks:h,staticGenerationBailout:$}=c,y="/api/community/stats/route";function b(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},76388:(t,e,n)=>{n.d(e,{Z:()=>a});var i=n(11185),o=n.n(i);let r=process.env.MONGODB_URI;if(!r)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let s=global.mongoose;s||(s=global.mongoose={conn:null,promise:null});let a=async function(){if(s.conn)return s.conn;s.promise||(s.promise=o().connect(r,{bufferCommands:!1}).then(t=>t));try{s.conn=await s.promise}catch(t){throw s.promise=null,t}return s.conn}},42097:(t,e,n)=>{n.d(e,{Z:()=>s});var i=n(11185),o=n.n(i);let r=new(o()).Schema({userId:{type:String,required:!0,index:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:500,trim:!0},mood:{type:Number,required:!0,min:1,max:10},marketSentiment:{type:String,enum:["bullish","bearish","neutral"],required:!0},cryptoSymbol:{type:String,uppercase:!0,trim:!0},tags:[{type:String,trim:!0,lowercase:!0}],likes:[{type:String}],comments:[{id:{type:String,default:()=>new(o()).Types.ObjectId().toString()},userId:{type:String,required:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:200,trim:!0},createdAt:{type:Date,default:Date.now}}],isPublic:{type:Boolean,default:!0}},{timestamps:!0});r.index({createdAt:-1}),r.index({userId:1,createdAt:-1}),r.index({isPublic:1,createdAt:-1}),r.index({tags:1}),r.index({cryptoSymbol:1}),r.virtual("commentCount").get(function(){return this.comments.length}),r.virtual("likeCount").get(function(){return this.likes.length}),r.methods.isLikedBy=function(t){return this.likes.includes(t)},r.methods.addLike=function(t){return this.likes.includes(t)||this.likes.push(t),this.save()},r.methods.removeLike=function(t){return this.likes=this.likes.filter(e=>e!==t),this.save()},r.methods.addComment=function(t,e,n){return this.comments.push({id:new(o()).Types.ObjectId().toString(),userId:t,username:e,content:n.trim(),createdAt:new Date}),this.save()};let s=o().models.CommunityPost||o().model("CommunityPost",r)}};var e=require("../../../../webpack-runtime.js");e.C(t);var n=t=>e(e.s=t),i=e.X(0,[120,971],()=>n(22356));module.exports=i})();