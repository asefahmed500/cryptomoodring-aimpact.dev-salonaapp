"use strict";(()=>{var e={};e.id=768,e.ids=[768],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},64557:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>k,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>x});var i={};r.r(i),r.d(i,{POST:()=>m});var n=r(89462),s=r(75345),o=r(57143),u=r(92969),a=r(90619),l=r(76388),d=r(42097);async function m(e,{params:t}){try{await (0,l.Z)();let e=await (0,a.getServerSession)();if(!e?.user?.email)return u.Z.json({message:"Unauthorized"},{status:401});let{postId:r}=t;if(!r)return u.Z.json({message:"Post ID is required"},{status:400});let i=await d.Z.findById(r);if(!i)return u.Z.json({message:"Post not found"},{status:404});let n=e.user.email,s=i.likes.includes(n);return s?i.likes=i.likes.filter(e=>e!==n):i.likes.push(n),await i.save(),u.Z.json({postId:i._id,isLiked:!s,likesCount:i.likes.length,message:s?"Post unliked":"Post liked"})}catch(e){return console.error("Toggle like error:",e),u.Z.json({message:"Internal server error"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/community/[postId]/like/route",pathname:"/api/community/[postId]/like",filename:"route",bundlePath:"app/api/community/[postId]/like/route"},resolvedPagePath:"E:\\project_qcatuy\\src\\app\\api\\community\\[postId]\\like\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:h,headerHooks:y,staticGenerationBailout:x}=c,k="/api/community/[postId]/like/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},76388:(e,t,r)=>{r.d(t,{Z:()=>u});var i=r(11185),n=r.n(i);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");let o=global.mongoose;o||(o=global.mongoose={conn:null,promise:null});let u=async function(){if(o.conn)return o.conn;o.promise||(o.promise=n().connect(s,{bufferCommands:!1}).then(e=>e));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}},42097:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(11185),n=r.n(i);let s=new(n()).Schema({userId:{type:String,required:!0,index:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:500,trim:!0},mood:{type:Number,required:!0,min:1,max:10},marketSentiment:{type:String,enum:["bullish","bearish","neutral"],required:!0},cryptoSymbol:{type:String,uppercase:!0,trim:!0},tags:[{type:String,trim:!0,lowercase:!0}],likes:[{type:String}],comments:[{id:{type:String,default:()=>new(n()).Types.ObjectId().toString()},userId:{type:String,required:!0},username:{type:String,required:!0,trim:!0},content:{type:String,required:!0,maxlength:200,trim:!0},createdAt:{type:Date,default:Date.now}}],isPublic:{type:Boolean,default:!0}},{timestamps:!0});s.index({createdAt:-1}),s.index({userId:1,createdAt:-1}),s.index({isPublic:1,createdAt:-1}),s.index({tags:1}),s.index({cryptoSymbol:1}),s.virtual("commentCount").get(function(){return this.comments.length}),s.virtual("likeCount").get(function(){return this.likes.length}),s.methods.isLikedBy=function(e){return this.likes.includes(e)},s.methods.addLike=function(e){return this.likes.includes(e)||this.likes.push(e),this.save()},s.methods.removeLike=function(e){return this.likes=this.likes.filter(t=>t!==e),this.save()},s.methods.addComment=function(e,t,r){return this.comments.push({id:new(n()).Types.ObjectId().toString(),userId:e,username:t,content:r.trim(),createdAt:new Date}),this.save()};let o=n().models.CommunityPost||n().model("CommunityPost",s)}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[120,971,363,619],()=>r(64557));module.exports=i})();